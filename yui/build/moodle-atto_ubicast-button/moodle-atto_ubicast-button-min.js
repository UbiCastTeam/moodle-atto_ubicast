YUI.add("moodle-atto_ubicast-button",function(s,e){var d="atto_ubicast",l=0,i=!0;function o(){for(var e,t=0;t<window.document.body.classList.length;t++)if(window.document.body.classList[t].startsWith("course-"))return 2===(e=window.document.body.classList[t].split("-")).length&&parseInt(e[1],10)||0;return 0}s.namespace("M.atto_ubicast").Button=s.Base.create("button",s.M.editor_atto.EditorPlugin,[],{initializer:function(){var e,t;if(this.get("enabled")&&(this.addButton({icon:"icon",iconComponent:d,callback:this.openChoicesDialogue}),i)){if(l=o(),o()<2)for(e=document.getElementsByClassName("atto_ubicast_button"),t=0;t<e.length;t++)e[t].style.display="none";i=!1}},_currentSelection:null,_dialogContent:null,openChoicesDialogue:function(){this._showDialogue()},_showDialogue:function(){var n,a,e;this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&(n=this.getDialogue({headerContent:M.util.get_string("pluginname",d),width:"450px",focusAfterHide:!0}),window.MediaSelector||((e=document.createElement("script")).type="text/javascript",e.src=window.M.cfg.wwwroot+"/mod/ubicast/statics/media_selector.js?_=14",document.getElementsByTagName("body")[0].appendChild(e)),a=this,(e=new XMLHttpRequest).onreadystatechange=function(){var e,t,i,o;4===this.readyState&&200===this.status&&(e="id_resource_atto_ubicast_"+(new Date).getTime(),(t=s.Node.create(this.responseText)).set("id",e),i=s.Node.create('<div style="text-align: center;"></div>'),o=M.util.get_string("inputsubmit",d),i.append(s.Node.create('<button type="submit" class="submit">'+o+"</button>")),t.append(i),t.on("submit",a._setVideo,a),a._dialogContent=t,n.set("bodyContent",t).show(),setTimeout(function(){window.mediaSelector=new window.MediaSelector({moodleURL:window.M.cfg.wwwroot+"/mod/ubicast/lti.php?id="+l,nudgisURL:t.one("#nudgis_url").get("value"),filterBySpeaker:"1"===t.one("#nudgis_speaker_filter").get("value"),target:e})},window.MediaSelector?10:2e3))},e.open("GET",window.M.cfg.wwwroot+"/lib/editor/atto/plugins/ubicast/media.php",!0),e.send())},_setVideo:function(e){var t,i,o,n;return e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),e=this._dialogContent.one("#id_mediaid").get("value"),t=this._dialogContent.one("#media_width").get("value"),i=this._dialogContent.one("#media_height").get("value"),n=this._dialogContent.one("input[name=mediaimg]").get("value"),e&&(o=this.get("host"),this.editor.focus(),o.setSelection(this._currentSelection),n=1===this.get("usefilter")?'<img class="atto_ubicast courseid_{{ courseId }}_mediaid_{{ mediaId }}"style="display: block; width: {{ mediaW }}; height: {{ mediaH }};" src="'+(this.get("ubicast_url")+n)+'"/>':'<iframe class="nudgis-iframe" style="width: {{ mediaW }}; height: {{ mediaH }}; background-color: #ddd;" src="'+window.M.cfg.wwwroot+'/lib/editor/atto/plugins/ubicast/view.php?course={{ courseId }}&video={{ mediaId }}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen="allowfullscreen"></iframe>',n=s.Handlebars.compile(n)({courseId:l,mediaId:e,mediaW:t,mediaH:i}),o.insertContentAtFocusPoint(n),this.markUpdated()),!1}},{ATTRS:{enabled:null,ubicast_url:null,usefilter:null}})},"@VERSION@",{requires:["promise","moodle-editor_atto-plugin","event-valuechange"]});